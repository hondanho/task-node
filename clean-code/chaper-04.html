<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Chương 4 - CƠM-MỪN | I’m here</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Chương 4 - CƠM-MỪN" />
<meta name="author" content="hondanho" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="“Đừng biến đống code gớm ghiếc của bạn thành comment - hãy viết lại nó” - Brian W. Kernighan and P. J. Plaugher" />
<meta property="og:description" content="“Đừng biến đống code gớm ghiếc của bạn thành comment - hãy viết lại nó” - Brian W. Kernighan and P. J. Plaugher" />
<link rel="canonical" href="http://localhost:4000/clean-code/chaper-04" />
<meta property="og:url" content="http://localhost:4000/clean-code/chaper-04" />
<meta property="og:site_name" content="I’m here" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-08-23T00:00:00+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Chương 4 - CƠM-MỪN" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"hondanho"},"dateModified":"2024-08-23T00:00:00+07:00","datePublished":"2024-08-23T00:00:00+07:00","description":"“Đừng biến đống code gớm ghiếc của bạn thành comment - hãy viết lại nó” - Brian W. Kernighan and P. J. Plaugher","headline":"Chương 4 - CƠM-MỪN","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/clean-code/chaper-04"},"url":"http://localhost:4000/clean-code/chaper-04"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="I'm here" /></head>
<body><header class="site-header">

  <div class="wrapper"><a href="/" title="">
      Archive
    </a>
    <a href="/category.html">
      Categories
    </a>
    <p>The latest tips and news from the hondanho blog</p></div>
</header>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var backToTopBtn = document.getElementById("back-to-top");

    window.addEventListener("scroll", function () {
      if (window.pageYOffset > 300) {
        backToTopBtn.style.display = "block";
      } else {
        backToTopBtn.style.display = "none";
      }
    });

    backToTopBtn.addEventListener("click", function (event) {
      event.preventDefault();
      window.scrollTo({
        top: 0,
        behavior: "smooth"
      });
    });
  });
</script><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Chương 4 - CƠM-MỪN</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-08-23T00:00:00+07:00" itemprop="datePublished">Aug 23, 2024
      </time>• posted on  <a class="category-name" href="/category/clean-code">clean-code</a></p>
        
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>“<em>Đừng biến đống code gớm ghiếc của bạn thành comment - hãy viết lại nó”</em><br />
<em>- Brian W. Kernighan and P. J. Plaugher</em></p>

<p>Không gì hữu ích bằng một comment được đặt đúng chổ. Không gì có thể làm lộn xộn đống code của bạn, ngoại trừ những comment ngu xuẩn và dối trá. Và không gì có thể gây nguy hiểm bằng một comment cộc lốc từ đời nào và lại không đúng sự thật.</p>

<p>Các comment không phải là <em>Bản danh sách của Schindler</em> (Schindler’s List – <a href="https://en.wikipedia.org/wiki/Schindler%27s_List">https://en.wikipedia.org/wiki/Schindler’s_List</a>. Chúng không tốt hoàn toàn như bạn nghĩ. Các comment, tốt nhất, nên trở thành sự lựa chọn cuối cùng. Nếu ngôn ngữ lập trình của chúng ta có đầy đủ khả năng diễn đạt, hoặc nếu chúng ta có đủ tài năng sử dụng code để thể hiện hết ý định của mình thì chúng ta đã không cần đến những dòng comment.</p>

<p>Việc dùng đúng các comment là một cách để bù đắp cho sự thất bại của chúng ta trong việc thể hiện ý nghĩa của những dòng code. Hãy lưu ý rằng tôi đã dùng từ thất bại. Chính xác là vậy – comment luôn luôn là sự thất bại. Chúng ta phải có chúng vì chúng ta không thể thể hiện hết ý nghĩa của code, và việc sử dụng chúng không phải là nguyên nhân được tán dương.</p>

<p>Vậy nên, khi bạn thấy mình cần viết comment, hãy suy nghĩ kỹ xem liệu có cách nào đó để biến các dòng code thành chính xác những gì bạn muốn thể hiện hay không. Mỗi khi bạn thể hiện chính xác ý nghĩa của code, hãy tự khích lệ mình. Mỗi khi bạn viết comment, bạn nên tự vả vào mặt cho sự thất bại đó .</p>

<p>Tại sao tôi lại thất vọng về các comment? Vì chúng đầy dối trá. Không phải lúc nào cũng vậy, nhưng vấn đề này lại rất thường xuyên xãy ra: Comment càng cũ và càng không liên quan tới code mà nó mô tả, càng có nhiều khả năng nó sai. Lý do rất đơn giản, các lập trình viên không thể bảo trì chúng.</p>

<p>Code của dự án thì thay đổi và phát triển liên tục. Các khối dữ liệu di chuyển từ nơi này đến nơi kia. Những khối đó tách ra và tái lập để tạo nên chương trình. Thật không may, những comment không phải lúc nào cũng theo kịp chúng. Comment thì thường xuyên bị tách ra khỏi code mà nó mô tả và trở nên đứt đoạn với độ chính xác giảm dần. Ví dụ, hãy xem những gì xãy ra với comment này và dòng code mà nó dự định mô tả:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">MockRequest</span> <span class="n">request</span><span class="o">;</span>
<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">HTTP_DATE_REGEXP</span> <span class="o">=</span>
 <span class="s">"[SMTWF][a-z]{2}\\,\\s[0-9]{2}\\s[JFMASOND][a-z]{2}\\s"</span><span class="o">+</span>
 <span class="s">"[0-9]{4}\\s[0-9]{2}\\:[0-9]{2}\\:[0-9]{2}\\sGMT"</span><span class="o">;</span>
<span class="kd">private</span> <span class="nc">Response</span> <span class="n">response</span><span class="o">;</span>
<span class="kd">private</span> <span class="nc">FitNesseContext</span> <span class="n">context</span><span class="o">;</span>
<span class="kd">private</span> <span class="nc">FileResponder</span> <span class="n">responder</span><span class="o">;</span>
<span class="kd">private</span> <span class="nc">Locale</span> <span class="n">saveLocale</span><span class="o">;</span>
<span class="c1">// Example: "Tue, 02 Apr 2003 22:18:49 GMT"</span>
</code></pre></div></div>

<p>Các biến khác có thể được thêm vào sau đó đặt xen kẽ vào giữa giá trị HTTP_DATE_REGEXP. Giá trị HTTP_DATE_REGEXP được viết lại và comment của bạn thì tan nát. 🙂</p>

<p>Có quan điểm cho rằng các lập trình viên nên có đủ kỷ luật để sửa cả những dòng comment khi họ đã thay đổi code. Tôi đồng ý, họ nên như thế. Nhưng tôi sẽ chọn cách làm cho code rõ ràng dễ hiểu, đến mức nó không cần các comment ngay từ đầu.</p>

<p>Những dòng comment bậy còn tồi tệ hơn là không comment. Chúng lừa gạt và đánh lạc hướng người đọc. Chúng đưa ra những dự tính không bao giờ được thực hiện. Chúng đặt ra những quy tắc cũ, không cần, hoặc không nên được tuân theo nữa.</p>

<p>Chân lý chỉ có thể tìm thấy tại một nơi duy nhất: Code. Chỉ có code mới nói cho bạn biết thật sự những gì nó làm. Nó là nguồn thông tin chính xác duy nhất. Do đó, mặc dù comment đôi khi là cần thiết, nhưng chúng tôi sẽ cố gắng để giảm thiểu nó.</p>

<h2 id="đừng-dùng-comment-để-làm-màu-cho-code">Đừng dùng comment để làm màu cho code</h2>

<p>Một trong những động lực to lớn để viết comment là do code tồi, code tối nghĩa. Chúng ta viết một hàm và chúng ta biết nó khó hiểu, nó vô tổ chức, chúng ta biết nó là một đống hỗ lốn. Vậy nên chúng ta tự nhủ rằng: “Ồ, tốt hơn nên viết comment ở đây!”. Không! Tốt hơn bạn nên viết lại code!</p>

<p>Code sáng nghĩa và rõ ràng với ít comment sẽ tuyệt vời hơn so với code tối nghĩa, phức tạp với nhiều comment. Thay vì dành thời gian để viết comment giải thích mớ code hỗ lốn đó, hãy dành thời gian để dọn dẹp nó.</p>

<h2 id="giải-thích-ý-nghĩa-ngay-trong-code">Giải thích ý nghĩa ngay trong code</h2>

<p>Chắc chắn có những lúc code của bạn rất khó để giải thích nó đang làm gì. Thật không may, điều này làm cho nhiều lập trình viên cho rằng code hiếm khi là một cách tốt để giải thích. Điều đó hoàn toàn sai. Bạn muốn nhìn thấy điều gì? Cái này:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Check to see if the employee is eligible for full benefits</span>
<span class="k">if</span> <span class="o">((</span><span class="n">employee</span><span class="o">.</span><span class="na">flags</span> <span class="o">&amp;</span> <span class="no">HOURLY_FLAG</span><span class="o">)</span> <span class="o">&amp;&amp;</span> 
<span class="o">(</span><span class="n">employee</span><span class="o">.</span><span class="na">age</span> <span class="o">&gt;</span> <span class="mi">65</span><span class="o">))</span>
</code></pre></div></div>

<p>Hay cái này?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">employee</span><span class="o">.</span><span class="na">isEligibleForFullBenefits</span><span class="o">())</span>
</code></pre></div></div>

<p>Chỉ mất vài giây suy nghĩ để truyền hết thông điệp của bạn vào code. Trong nhiều trường hợp, nó chỉ đơn giản là tạo ra một hàm có tên giống với comment mà bạn muốn viết</p>

<h2 id="good-comments">Good Comments</h2>

<p>Một số comment là cần thiết hoặc có ích. Chúng ta sẽ xem xet một vài trường hợp mà tôi cho là xứng đáng để bạn bỏ công ra viết. Tuy nhiên, hãy nhớ rằng comment thật sự tốt là comment không cần phải viết ra.</p>

<h3 id="comment-pháp-lý">Comment pháp lý</h3>

<p>Đôi khi các tiêu chuẩn mã hóa doanh nghiệp buộc chúng ta phải viết một số comment nhất định vì lý do pháp lý. Ví dụ, tuyên bố bản quyền và quyền tác giả là những điều cần thiết và hợp lý để đưa vào comment khi bắt đầu mỗi source code file.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Copyright (C) 2003,2004,2005 by Object Mentor, Inc.
 * All rights reserved. 
 * Released under the terms of the GNU General Public License version
 * 2 or later.
 */</span>
</code></pre></div></div>

<p>Đừng đưa cả hợp đồng hay những điều luật vào comment. Nếu có thể, hãy tham khảo một vài giấy phép tiêu chuẩn hay tài liệu bên ngoài khác thay vì đưa tất cả những điều khoản và điều kiện vào.</p>

<h3 id="comment-cung-cấp-thông-tin">Comment cung cấp thông tin</h3>

<p>Cung cấp thông tin cơ bản với một vài dòng comment đôi khi rất hữu ích. Ví dụ, hãy xem cách mà comment này giải thích về giá trị trả về của một phương thức trừu tượng:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Returns an instance of the Responder being tested.</span>
<span class="n">protectedabstractResponder</span> <span class="nf">responderInstance</span><span class="o">();</span>
</code></pre></div></div>

<p>Một comment như thế này, đôi khi, có thể là hữu ích. Nhưng tốt hơn là sử dụng tên của hàm để truyền đạt thông tin nếu có thể. Ví dụ, trong trường hợp này, chúng ta có thể dọn dẹp comment trên bằng cách đặt lại tên hàm thành responderBeingTested.</p>

<p>Trường hợp dưới đây có vẻ tốt hơn một chút:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// format matched kk:mm:ss EEE, MMM dd, yyyy </span>
<span class="nc">Pattern</span> <span class="n">timeMatcher</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span>
  <span class="s">"\\d*:\\d*:\\d* \\w*, \\w* \\d*, \\d*"</span><span class="o">);</span>
</code></pre></div></div>

<p>Trong trường hợp này, comment cho chúng ta biết rằng biểu thức được tạo ra khớp với thời gian và ngày tháng, và được định dạng bằng hàm SimpleDateFormat.format. Tuy nhiên, nó có thể rõ ràng hơn nếu code này được chuyển sang một lớp đặc biệt chuyển đổi định dạng của ngày và thời gian. Và sau đó, bạn có thể đưa comment trên vào sọt rác.</p>

<h3 id="giải-thích-mục-đích">Giải thích mục đích</h3>

<p>Đôi khi comment không chỉ cung cấp thông tin về những dòng code mà còn cung cấp ý định đằng sau nó. Trong trường hợp sau đây, chúng tôi thấy một comment ghi lại một quyết định thú vị: khi so sánh hai đối tượng, tác giả quyết định rằng anh ta muốn sắp xếp các đối tượng của lớp mình <em>luôn</em> cao hơn các đối tượng khác.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span>
<span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">WikiPagePath</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="nc">WikiPagePath</span> <span class="n">p</span> <span class="o">=</span> <span class="o">(</span><span class="nc">WikiPagePath</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">compressedName</span> <span class="o">=</span> <span class="nc">StringUtil</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">names</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">compressedArgumentName</span> <span class="o">=</span> <span class="nc">StringUtil</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">names</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">compressedName</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">compressedArgumentName</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">;</span> <span class="c1">// we are greater because we are the right type.</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Dưới đây là một ví dụ tốt hơn. Có thể bạn không đồng tình với cách giải quyết vấn đề của tác giả, nhưng ít ra bạn biết được anh ấy đang cố gắng làm gì</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testConcurrentAddWidgets</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">WidgetBuilder</span> <span class="n">widgetBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WidgetBuilder</span><span class="o">(</span><span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">BoldWidget</span><span class="o">.</span><span class="na">class</span><span class="o">});</span>
    <span class="nc">String</span> <span class="n">text</span> <span class="o">=</span> <span class="s">"'''bold text'''"</span><span class="o">;</span>
    <span class="nc">ParentWidget</span> <span class="n">parent</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">BoldWidget</span><span class="o">(</span><span class="k">new</span> <span class="nc">MockWidgetRoot</span><span class="o">(),</span> <span class="s">"'''bold text'''"</span><span class="o">);</span>
    <span class="nc">AtomicBoolean</span> <span class="n">failFlag</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicBoolean</span><span class="o">();</span>
    <span class="n">failFlag</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="c1">//This is our best attempt to get a race condition</span>
    <span class="c1">//by creating large number of threads.</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">25000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="nc">WidgetBuilderThread</span> <span class="n">widgetBuilderThread</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">WidgetBuilderThread</span><span class="o">(</span><span class="n">widgetBuilder</span><span class="o">,</span> <span class="n">text</span><span class="o">,</span> <span class="n">parent</span><span class="o">,</span>
								<span class="n">failFlag</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">widgetBuilderThread</span><span class="o">);</span>
        <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="n">failFlag</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p><em>Race condition</em> là gì: <a href="https://en.wikipedia.org/wiki/Race_condition">https://en.wikipedia.org/</a></p>

<p>Hoặc link Tiếng Việt: <a href="https://vi.wikipedia.org/wiki/Tương_tranh_%28khoa_học_máy_tính%29">https://vi.wikipedia.org</a></p>

<h3 id="làm-dễ-hiểu">Làm dễ hiểu</h3>

<p>Đôi khi bạn cần dùng comment để diễn giải ý nghĩa của các đối số khó hiểu hoặc giá trị trả về, để biến chúng thành thứ gì đó có thể hiểu được. Nhưng tốt nhất vẫn là tìm cách làm cho các đối số hoặc giá trị trả về đó trở nên rõ ràng theo cách của bạn. Nhưng khi nó là một phần của thư viện, hoặc thuộc về một phần code mà bạn không có quyền tùy chỉnh, thì một comment giải thích dễ hiểu có thể có ích trong trường hợp này.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCompareTo</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span>
<span class="o">{</span>
    <span class="nc">WikiPagePath</span> <span class="n">a</span> <span class="o">=</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageA"</span><span class="o">);</span>
    <span class="nc">WikiPagePath</span> <span class="n">ab</span> <span class="o">=</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageA.PageB"</span><span class="o">);</span>
    <span class="nc">WikiPagePath</span> <span class="n">b</span> <span class="o">=</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageB"</span><span class="o">);</span>
    <span class="nc">WikiPagePath</span> <span class="n">aa</span> <span class="o">=</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageA.PageA"</span><span class="o">);</span>
    <span class="nc">WikiPagePath</span> <span class="n">bb</span> <span class="o">=</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageB.PageB"</span><span class="o">);</span>
    <span class="nc">WikiPagePath</span> <span class="n">ba</span> <span class="o">=</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageB.PageA"</span><span class="o">);</span>

    <span class="n">assertTrue</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// a == a</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// a != b</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">ab</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">ab</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// ab == ab</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span> <span class="c1">// a &lt; b</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">aa</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">ab</span><span class="o">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span> <span class="c1">// aa &lt; ab</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">ba</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">bb</span><span class="o">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span> <span class="c1">// ba &lt; bb</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span> <span class="c1">// b &gt; a</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">ab</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">aa</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span> <span class="c1">// ab &gt; aa</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">bb</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">ba</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span> <span class="c1">// bb &gt; ba</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Dĩ nhiên, khả năng các comment dạng này cung cấp thông tin không chính xác là khá cao. Xem lại các ví dụ trước để thấy rằng việc xác nhận thông tin từ comment khó thế nào. Điều này giải thích lý do tại sao làm cho comment dễ hiểu là cần thiết, mặc dù điều đó đồng nghĩa với sự mạo hiểm. Vậy nên trước khi bạn viết những comment như thế này, hãy chắc chắn rằng không còn cách nào tối ưu hơn, vì sau đó bạn cần quan tâm đến độ chính xác của chúng mỗi khi bạn chỉnh sửa lại code.</p>

<h3 id="các-cảnh-báo-về-hậu-quả">Các cảnh báo về hậu quả</h3>

<p>Đôi khi nó rất hữu ích để cảnh báo các lập trình viên khác về hậu quả xảy ra. Ví dụ, đây là một comment giải thích tại sao test case này lại bị tắt:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Don't run unless you </span>
<span class="c1">// have some time to kill – Đừng chạy hàm này, trừ khi mày quá rảnh </span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">_testWithReallyBigFile</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">writeLinesToFile</span><span class="o">(</span><span class="mi">10000000</span><span class="o">);</span>
    <span class="n">response</span><span class="o">.</span><span class="na">setBody</span><span class="o">(</span><span class="n">testFile</span><span class="o">);</span> 
    <span class="n">response</span><span class="o">.</span><span class="na">readyToSend</span><span class="o">(</span><span class="k">this</span><span class="o">);</span> 
    <span class="nc">String</span> <span class="n">responseString</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="n">assertSubString</span><span class="o">(</span><span class="s">"Content-Length: 1000000000"</span><span class="o">,</span> <span class="n">responseString</span><span class="o">);</span> 
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">bytesSent</span> <span class="o">&gt;</span> <span class="mi">1000000000</span><span class="o">);</span> 
<span class="o">}</span>
</code></pre></div></div>

<p>Tất nhiên là ngày nay, chúng tôi tắt các test case bằng cách sử dụng thuộc tính <code class="language-plaintext highlighter-rouge">@Ignore</code> với một chuỗi giải thích thích hợp: <code class="language-plaintext highlighter-rouge">@Ignore ("It takes too long to run")</code>. Nhưng trước khi JUnit 4 xuất hiện, việc đặt một dấu gạch dưới vào trước tên hàm là một quy tắc rất phổ biến. Các comment đồng thời được xem như là cách đánh dấu để lập trình viên chú ý đến cảnh báo của hàm hơn.</p>

<p>Đây là một ví dụ đau khổ khác:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="nc">SimpleDateFormat</span> <span class="nf">makeStandardHttpDateFormat</span><span class="o">()</span>
<span class="o">{</span>
    <span class="c1">//SimpleDateFormat is not thread safe,</span>
    <span class="c1">//so we need to create each instance independently.</span>
    <span class="nc">SimpleDateFormat</span> <span class="n">df</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"EEE, dd MMM yyyy HH:mm:ss z"</span><span class="o">);</span>
    <span class="n">df</span><span class="o">.</span><span class="na">setTimeZone</span><span class="o">(</span><span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"GMT"</span><span class="o">));</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Có thể còn nhiều cách tốt hơn. Tôi đồng ý. Nhưng comment trong trường hợp này là hoàn toàn hợp lý, nó sẽ ngăn được một số lập trình viên ham hố sử dụng một phương thức khởi tạo tĩnh.</p>

<h3 id="todo-comments">TODO comments</h3>

<p>Đôi khi việc để lại các dòng comment dạng //TODO là điều cần thiết. Trong trường hợp dưới đây, comment dạng TODO giải thích tại sao hàm này lại là hàm suy biến, và tương lai của hàm sẽ như thế nào:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// TODO-MdM these are not needed – Hàm này không cần thiết</span>
<span class="c1">// We expect this to go away when we do the checkout model</span>
<span class="c1">// Nó sẽ bị xóa khi chúng tôi thực hiện mô hình thanh toán</span>
<span class="kd">protected</span> <span class="nc">VersionInfo</span> <span class="nf">makeVersion</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span>
<span class="o">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Những comment dạng TODO là những công việc mà lập trình viên cho rằng nên được thực hiện, nhưng vì lý do nào đó mà họ không thể thực hiện nó ngay lúc này. Nó có thể là một lời nhắc để xóa một hàm không dùng nữa, hoặc yêu cầu người khác xem xét một số vấn đề: đặt lại một cái tên khác tốt hơn, lời nhắc thay đổi code của hàm khi kế hoạch của dự án thay đổi,.. Nhưng dù TODO có là gì đi nữa, nó chắc chắn không phải là lý do để bạn quăng đống code ẩu, code bừa vào dự án.</p>

<p>Ngày nay, hầu hết các IDE đều cung cấp các tính năng đặc biệt để định vị các comment TODO, do đó bạn không cần lo việc bỏ quên/lạc mất nó. Tuy vậy, bạn sẽ không muốn code của bạn bị lấp đầy bởi TODO. Vậy nên hãy thường xuyên để mắt tới chúng và dọn dẹp chúng ngay khi có thể.</p>

<h3 id="khuếch-đại">Khuếch đại</h3>

<p>Comment có thể được dùng để khuếch đại tầm quan trọng của một cái gì đó có vẻ không quan trọng:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">listItemContent</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">trim</span><span class="o">();</span>
<span class="c1">// the trim is real important. It removes the starting</span>
<span class="c1">// spaces that could cause the item to be recognized</span>
<span class="c1">// as another list.</span>
<span class="k">new</span> <span class="nf">ListItemWidget</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">listItemContent</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">level</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
<span class="k">return</span> <span class="nf">buildList</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">match</span><span class="o">.</span><span class="na">end</span><span class="o">()));</span>
</code></pre></div></div>

<h3 id="javadocs-in-public-apis">Javadocs in Public APIs</h3>

<p>Không có gì hữu ích và tuyệt vời bằng một public API được mô tả tốt. Các javadoc của thư viện chuẩn của Java là một trường hợp điển hình. Sẽ rất khó để viết các chương trình Java mà thiếu chúng.</p>

<p>Nếu đang viết một public API, chắc chắn bạn nên viết javadoc tốt cho nó. Nhưng hãy ghi nhớ những lời khuyên còn lại của chương này, các javadoc có thể là một cú lừa, hoặc mang lại phiền toái như bất kỳ comment nào khác .</p>

<h2 id="bad-comments">Bad Comments</h2>

<p>Đa số các comment rơi vào thể loại này. Chúng thường được sử dụng như cái cớ cho việc viết code rởm hoặc biện minh cho các cách giải quyết đầy thiếu sót, các giá trị không đầy đủ so với cách lập trình viên nghĩ về nó.</p>

<h3 id="độc-thoại">Độc thoại</h3>

<p>Quăng vào một comment chỉ vì bạn thấy <em>thích</em>, hoặc chỉ vì quá trình xử lý cần đến nó, điều đó được gọi là <em>hack</em> (giải quyết vấn đề không theo cách thường mà dùng thủ thuật, đường tắt,…). Nếu bạn quyết định viết comment, hãy dành thời gian cho nó để đảm bảo đó là comment tốt nhất mà bạn có thể viết.</p>

<p>Dưới đây là một ví dụ tôi tìm thấy trong FitNesse, comment này có thể hữu ích. Nhưng tác giả đã vội vàng hoặc đã không quan tâm nhiều đến nó. Cách anh ta độc thoại làm cho người đến sau cảm thấy hoang mang:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">loadProperties</span><span class="o">()</span>
<span class="o">{</span>
    <span class="k">try</span>
    <span class="o">{</span>
        <span class="nc">String</span> <span class="n">propertiesPath</span> <span class="o">=</span> <span class="n">propertiesLocation</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="no">PROPERTIES_FILE</span><span class="o">;</span>
        <span class="nc">FileInputStream</span> <span class="n">propertiesStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">propertiesPath</span><span class="o">);</span>
        <span class="n">loadedProperties</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">propertiesStream</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">catch</span><span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="c1">// No properties files means all defaults are loaded</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Comment trong khối cacth trên nghĩa là gì? Hẳn là nó có ý nghĩa gì đó đối với tác giả, nhưng lại không được diễn giải đầy đủ. Rõ ràng, nếu IOExeptionxãy ra, điều đó có nghĩa là không có thuộc tính file, và trong trường hợp này các thuộc tính mặc định sẽ được tải. Nhưng, cái gì sẽ tải thuộc tính mặc định? Những thuộc tính mặc định đó đã được tải trước khi gọi loadProperties()? Hay chúng được tải khi loadedProperties.load(propertiesStream) phát sinh Exception? Hay chúng được tải sau khi gọi loadProperties() ? Có phải tác giả chỉ đang cố làm hài lòng chính bản thân anh ta về việc bỏ trống khối catch? Hoặc, kinh khủng hơn – tác giả đã dùng comment như một dấu hiệu, để sau này quay lại và viết các đoạn code tải các thuộc tính mặc định vào khối catch?</p>

<p>Cách duy nhất là kiểm tra code của hệ thống để tìm hiểu những gì xảy ra. Bất kỳ comment nào khiến bạn phải lục tung code của hệ thống lên để tìm hiểu thì comment đó không truyền tải tốt thông tin cho bạn, và nó không xứng đáng với số bit nó chiếm trong mã nguồn.</p>

<h3 id="các-comment-thừa-thải">Các comment thừa thải</h3>

<p>Listing 4-1 cho thấy một hàm đơn giản với các comment ở đầu hoàn toàn thừa thải. Comment này, có lẽ, còn làm người đọc mất thời gian hơn so với việc đọc code của hàm.</p>

<p>| Listing 4-1 <strong>waitForClose</strong> |
| — |</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Utility method that returns when this.closed is true. Throws an exception</span>
<span class="c1">// if the timeout is reached.</span>
<span class="c1">// Phương thức return khi this.closed là true, phát sinh ngoại lệ nếu hết thời gian chờ</span>
<span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">waitForClose</span><span class="o">(</span><span class="kd">final</span> <span class="kt">long</span> <span class="n">timeoutMillis</span><span class="o">)</span>
<span class="kd">throws</span> <span class="nc">Exception</span>
<span class="o">{</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">closed</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">wait</span><span class="o">(</span><span class="n">timeoutMillis</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">closed</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="o">(</span><span class="s">"MockResponseSender could not be closed"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Comment này nhằm mục đích gì? Nó chắn chắn không cung cấp nhiều thông tin hơn code. Nó không diễn giải cho code, không cung cấp mục đích hoặc lý do. Nó không dễ hiểu hơn code. Sự thật là, nó ít chính xác hơn code nhưng lại lôi cuốn người đọc chấp nhận sự thiếu chính xác đó thay cho hiểu biết thật sự.</p>

<p>Bây giờ hãy xem xét vô số comment vô ích và dư thừa của javadocs trong Listing 4-2 được lấy từ Tomcat. Những comment này chỉ để làm lộn xộn và làm code thêm khó hiểu. Chúng tồn tại nhưng không vì mục đích cung cấp thông tin mà chỉ khiến mọi thứ tệ hơn. Tôi chỉ chỉ ra cho bạn được một vài dòng đầu tiên, còn nhiều hơn nữa nếu bạn xem qua hết module này.</p>

<p>| Listing 4-2 <strong>ContainerBase.java (Tomcat)</strong> |
| — |</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ContainerBase</span>
<span class="kd">implements</span> <span class="nc">Container</span><span class="o">,</span> <span class="nc">Lifecycle</span><span class="o">,</span> <span class="nc">Pipeline</span><span class="o">,</span>
<span class="nc">MBeanRegistration</span><span class="o">,</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="cm">/**
     * The processor delay for this component.
     */</span>
    <span class="kd">protected</span> <span class="kt">int</span> <span class="n">backgroundProcessorDelay</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
    <span class="cm">/**
     * The lifecycle event support for this component.
     */</span>
    <span class="kd">protected</span> <span class="nc">LifecycleSupport</span> <span class="n">lifecycle</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LifecycleSupport</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="cm">/**
     * The container event listeners for this Container.
     */</span>
    <span class="kd">protected</span> <span class="nc">ArrayList</span> <span class="n">listeners</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>
    <span class="cm">/**
     * The Loader implementation with which this Container is
     * associated.
     */</span>
    <span class="kd">protected</span> <span class="nc">Loader</span> <span class="n">loader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="cm">/**
     * The Logger implementation with which this Container is
     * associated.
     */</span>
    <span class="kd">protected</span> <span class="nc">Log</span> <span class="n">logger</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="cm">/**
     * Associated logger name.
     */</span>
    <span class="kd">protected</span> <span class="nc">String</span> <span class="n">logName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="cm">/**
     * The Manager implementation with which this Container is
     * associated.
     */</span>
    <span class="kd">protected</span> <span class="nc">Manager</span> <span class="n">manager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="cm">/**
     * The cluster with which this Container is associated.
     */</span>
    <span class="kd">protected</span> <span class="nc">Cluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="cm">/**
     * The human-readable name of this Container.
     */</span>
    <span class="kd">protected</span> <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="cm">/**
     * The parent Container to which this Container is a child.
     */</span>
    <span class="kd">protected</span> <span class="nc">Container</span> <span class="n">parent</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="cm">/**
     * The parent class loader to be configured when we install a
     * Loader.
     */</span>
    <span class="kd">protected</span> <span class="nc">ClassLoader</span> <span class="n">parentClassLoader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="cm">/**
     * The Pipeline object with which this Container is
     * associated.
     */</span>
    <span class="kd">protected</span> <span class="nc">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StandardPipeline</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="cm">/**
     * The Realm with which this Container is associated.
     */</span>
    <span class="kd">protected</span> <span class="nc">Realm</span> <span class="n">realm</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="cm">/**
     * The resources DirContext object with which this Container
     * is associated.
     */</span>
    <span class="kd">protected</span> <span class="nc">DirContext</span> <span class="n">resources</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</code></pre></div></div>

<h3 id="các-comment-sai-sự-thật">Các comment sai sự thật</h3>

<p>Đôi khi, với mục đích hoàn toàn trong sáng, một lập trình viên diễn đạt ý định của anh ta trong comment, nhưng nó lại không đủ chính xác. Hãy dành một ít thời gian để xem lại comment dư thừa và sai lệch trong Listing 4-1.</p>

<p>Bạn có phát hiện ra comment ở Listing 4-1 sai lệch như thế nào chưa? Phương thức không <code class="language-plaintext highlighter-rouge">return</code> khi <code class="language-plaintext highlighter-rouge">this.closed</code> là <code class="language-plaintext highlighter-rouge">true</code>, nó <code class="language-plaintext highlighter-rouge">return</code> nếu <code class="language-plaintext highlighter-rouge">this.closed</code> là <code class="language-plaintext highlighter-rouge">true</code>. Mặt khác, nó giả vờ chờ một khoản thời gian và sinh ra một Exception nếu <code class="language-plaintext highlighter-rouge">this.closed</code> vẫn chưa là <code class="language-plaintext highlighter-rouge">true</code>.</p>

<p>Một chút thông tin sai lệch, ẩn nấp trong một comment khó đọc hơn cả code mà nó diễn giải. Điều này có thể khiến một lập trình viên khác gọi hàm này và mong muốn nó return ngay khi this.closed trở thành true. Sau đó anh ta phải debug chương trình để tìm câu trả lời cho việc nó thực thi quá chậm.</p>

<h3 id="các-comment-bắt-buộc">Các comment bắt buộc</h3>

<p>Thật điên rồ khi cho rằng tất cả các hàm đều phải có javadoc, hoặc mọi biến đều phải có comment. Những comment như vậy chỉ làm rối code, đưa ra những lời bịa đặt, và ủng hộ việc gây nhầm lẫn và vô tổ chức.</p>

<p>Ví dụ, javadoc được yêu cầu cho mọi hàm dẫn đến sự kinh khủng khiếp như Listing 4-3. Tình trạng lộn xộn này không giúp ích được gì mà ngược lại,nó chỉ làm xáo trộn code và ngầm tạo ra những cú lừa khác,…</p>

<p>| Listing 4-3 |
| — |</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 *
 * @param title The title of the CD
 * @param author The author of the CD
 * @param tracks The number of tracks on the CD
 * @param durationInMinutes The duration of the CD in minutes
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCD</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">,</span> <span class="nc">String</span> <span class="n">author</span><span class="o">,</span>
 <span class="kt">int</span> <span class="n">tracks</span><span class="o">,</span> <span class="kt">int</span> <span class="n">durationInMinutes</span><span class="o">)</span> <span class="o">{</span>
    <span class="no">CD</span> <span class="n">cd</span> <span class="o">=</span> <span class="k">new</span> <span class="no">CD</span><span class="o">();</span>
    <span class="n">cd</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
    <span class="n">cd</span><span class="o">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">;</span>
    <span class="n">cd</span><span class="o">.</span><span class="na">tracks</span> <span class="o">=</span> <span class="n">tracks</span><span class="o">;</span>
    <span class="n">cd</span><span class="o">.</span><span class="na">duration</span> <span class="o">=</span> <span class="n">duration</span><span class="o">;</span>
    <span class="n">cdList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">cd</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="các-comment-nhật-ký">Các comment nhật ký</h3>

<p>Đôi khi mọi người thêm một comment vào đầu module mỗi khi họ chỉnh sửa nó. Những comment này tích lũy như một loại nhật ký lưu lại mọi thay đổi đã từng được thực hiện. Tôi đã thấy một số module với hàng trăm dòng như thế này:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 * Changes (from 11-Oct-2001)
 * --------------------------
 * 11-Oct-2001 : Re-organised the class and moved it to new package
 * com.jrefinery.date (DG);
 * 05-Nov-2001 : Added a getDescription() method, and eliminated NotableDate
 * class (DG);
 * 12-Nov-2001 : IBD requires setDescription() method, now that NotableDate
 * class is gone (DG); Changed getPreviousDayOfWeek(),
 * getFollowingDayOfWeek() and getNearestDayOfWeek() to correct
 * bugs (DG);
 * 05-Dec-2001 : Fixed bug in SpreadsheetDate class (DG);
 * 29-May-2002 : Moved the month constants into a separate interface
 * (MonthConstants) (DG);
 * 27-Aug-2002 : Fixed bug in addMonths() method, thanks to N???levka Petr (DG);
 * 03-Oct-2002 : Fixed errors reported by Checkstyle (DG);
 * 13-Mar-2003 : Implemented Serializable (DG);
 * 29-May-2003 : Fixed bug in addMonths method (DG);
 * 04-Sep-2003 : Implemented Comparable. Updated the isInRange javadocs (DG);
 * 05-Jan-2005 : Fixed bug in addYears() method (1096282) (DG);
 */</span>
</code></pre></div></div>

<p>Ngày xửa ngày xưa, chúng tôi có lý do chính đáng để tạo và cập nhật các nhật ký này khi bắt đầu một module. Ở thời điểm đó, các hệ thống quản lý mã nguồn (source control) chưa xuất hiện và chúng tôi phải thực hiện điều này. Nhưng ngày nay, những nhật ký này chỉ làm module lộn xộn hơn. Chúng nên được loại bỏ hoàn toàn.</p>

<h3 id="các-comment-gây-nhiễu">Các comment gây nhiễu</h3>

<p>Đôi khi bạn gặp các comment không cung cấp thông tin gì ngoài sự phiền phức, chúng lặp lại một vấn đề hiển nhiên và không cung cấp thêm thông tin mới</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Default constructor.
 */</span>
<span class="kd">protected</span> <span class="nf">AnnualDateRule</span><span class="o">()</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Rìa-lý? Còn cái này:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** The day of the month. */</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">dayOfMonth</span><span class="o">;</span>
</code></pre></div></div>

<p>Và sau đó là sự thừa thãi này:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Returns the day of the month.
 *
 * @return the day of the month.
 */</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getDayOfMonth</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">dayOfMonth</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Những comment này phiền đến mức chúng tôi phải học cách bỏ qua chúng. Khi chúng tôi đọc code, mắt chúng tôi chỉ lướt qua chúng. Cuối cùng, các comment bắt đầu sai lệch khi code xung quanh chúng thay đổi, còn chúng thì không – ai lại để ý đến chúng chứ.</p>

<p>Comment đầu tiên trong Listing 4-4 có vẻ hợp lý, nó giải thích tại sao khối <code class="language-plaintext highlighter-rouge">catch</code> được bỏ qua. Nhưng comment thứ hai chỉ đơn thuần là gây nhiễu cho người đọc. Rõ ràng lập trình viên này đã rất mệt mỏi với việc viết các khối <code class="language-plaintext highlighter-rouge">try/catch</code> và anh ta đang trút giận.</p>

<p>| Listing 4-4 <strong>startSending</strong> |
| — |</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">startSending</span><span class="o">()</span>
<span class="o">{</span>
    <span class="k">try</span>
    <span class="o">{</span>
        <span class="n">doSending</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">catch</span><span class="o">(</span><span class="nc">SocketException</span> <span class="n">e</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="c1">// normal. someone stopped the request.</span>
    <span class="o">}</span>
    <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">try</span>
        <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">ErrorResponder</span><span class="o">.</span><span class="na">makeExceptionString</span><span class="o">(</span><span class="n">e</span><span class="o">));</span>
            <span class="n">response</span><span class="o">.</span><span class="na">closeAll</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e1</span><span class="o">)</span>
        <span class="o">{</span>
            <span class="c1">//Give me a break! – Đưa tao ra khỏi đây!</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Thay vì trút giận vào một comment vô giá trị và gây bối rối cho người đọc, lập trình viên nên nhận ra rằng vấn đề của anh ta có thể được giải quyết bằng cách tái cấu trúc lại phần code đó. Anh ta nên sử dụng năng lượng của mình cho việc chuyển khối try/catch đó thành một hàm riêng biệt, như trong Listing 4-5</p>

<p>| Listing 4-5 <strong>startSending (refactored)</strong> |
| — |</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">startSending</span><span class="o">()</span>
<span class="o">{</span>
    <span class="k">try</span>
    <span class="o">{</span>
        <span class="n">doSending</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">catch</span><span class="o">(</span><span class="nc">SocketException</span> <span class="n">e</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="c1">// normal. someone stopped the request.</span>
    <span class="o">}</span>
    <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">addExceptionAndCloseResponse</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">addExceptionAndCloseResponse</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span>
<span class="o">{</span>
    <span class="k">try</span>
    <span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">ErrorResponder</span><span class="o">.</span><span class="na">makeExceptionString</span><span class="o">(</span><span class="n">e</span><span class="o">));</span>
        <span class="n">response</span><span class="o">.</span><span class="na">closeAll</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e1</span><span class="o">)</span>
    <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Tránh việc viết comment gây nhiễu bằng quyết tâm làm sạch code. Bạn sẽ thấy điều đó làm cho bạn trở thành một lập trình viên đẳng cấp hơn, và hạnh phúc hơn.</p>

<h3 id="lại-là-các-comment-gây-nhiễu--nhưng-đáng-sợ-hơn">(Lại là) các comment gây nhiễu – nhưng đáng sợ hơn</h3>

<p>Các javadoc cũng có thể trở nên phiền phức. Mục đích của các javadoc sau là gì (từ một thư viện mã nguồn mở nổi tiếng)? Trả lời: Không gì cả. Chúng chỉ là những comment dư thừa, bị sao chép lại như một khao khát cung cấp tài liệu cho lập trình viên.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** The name. */</span>
<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
<span class="cm">/** The version. */</span>
<span class="kd">private</span> <span class="nc">String</span> <span class="n">version</span><span class="o">;</span>
<span class="cm">/** The licenceName. */</span>
<span class="kd">private</span> <span class="nc">String</span> <span class="n">licenceName</span><span class="o">;</span>
<span class="cm">/** The version. */</span>
<span class="kd">private</span> <span class="nc">String</span> <span class="n">info</span><span class="o">;</span>
</code></pre></div></div>

<p>Xem những comment trên một lần nữa, bạn có thấy lỗi cắt-dán không? Nếu tác giả đã không chú ý đến comment khi viết (hoặc dán) chúng, sao chúng ta có thể trông mong chúng giúp ích được chúng ta?</p>

<h3 id="đừng-dùng-comment-khi-bạn-có-thể-dùng-hàm-hoặc-biến">Đừng dùng comment khi bạn có thể dùng hàm hoặc biến</h3>

<p>Hãy xem xét đoạn code sau:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// does the module from the global list &lt;mod&gt; depend on the</span>
<span class="c1">// subsystem we are part of?</span>
<span class="k">if</span> <span class="o">(</span><span class="n">smodule</span><span class="o">.</span><span class="na">getDependSubsystems</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="n">subSysMod</span><span class="o">.</span><span class="na">getSubSystem</span><span class="o">()))</span>
</code></pre></div></div>

<p>Chúng có thể được viết lại mà không cần comment:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ArrayList</span> <span class="n">moduleDependees</span> <span class="o">=</span> <span class="n">smodule</span><span class="o">.</span><span class="na">getDependSubsystems</span><span class="o">();</span>
<span class="nc">String</span> <span class="n">ourSubSystem</span> <span class="o">=</span> <span class="n">subSysMod</span><span class="o">.</span><span class="na">getSubSystem</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">moduleDependees</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">ourSubSystem</span><span class="o">))</span>
</code></pre></div></div>

<p>Có thể tác giả đã viết comment trước (tôi đoán thế), và sau đó viết code để hoàn thành nội dung của comment. Tuy nhiên, tác giả nên tái cấu trúc code, như tôi đã làm, để comment được xóa mà không ảnh hưởng đến thông điệp của đoạn code đó.</p>

<h3 id="đánh-dấu-lãnh-thổ">Đánh dấu lãnh thổ</h3>

<p>Thỉnh thoảng vài lập trình viên thích đánh dấu một vị trí trong tệp mã nguồn. Ví dụ, gần đây tôi đã thấy thứ này trong một chương trình tôi đang xem xét:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Actions //////////////////////////////////</span>
</code></pre></div></div>

<p>Rất hiếm khi các hàm có cùng chức năng được tập hợp bên dưới một câu miêu tả như thế này. Nhưng nói chung, chúng đang bừa bộn nên cần phải loại bỏ, đặc biệt là cả tá dấu slash ở cuối câu.</p>

<p>Theo cách nghĩ này, một comment đánh dấu sẽ gây chú ý mạnh nếu bạn không thường xuyên nhìn thấy chúng. Vì vậy, hãy hạn chế dùng, và chỉ dùng nếu chúng mang lại lợi ích đáng kể. Nếu bị lạm dụng, chúng sẽ bị người đọc cho vào vùng “phiền phức” và nhanh chóng bị bỏ qua.</p>

<h3 id="các-comment-kết-thúc">Các comment kết thúc</h3>

<p>Đôi khi các lập trình viên sẽ đưa ra các comment cụ thể về việc đóng dấu ngoặc nhọn, như trong Listing 4-6. Mặc dù điều này có thể có ý nghĩa với các hàm dài và có nhiều cấu trúc lồng nhau, nhưng chúng lại thường được dùng trong các hàm nhỏ, hoặc các hàm mà lập trình viên thấy thích. Vì vậy lần tới nếu muốn đánh dấu kết thúc một khối lệnh phức tạp, hãy thử chia nhỏ hoặc rút ngắn hàm của bạn.</p>

<p>| Listing 4-6 <strong>wc.java</strong> |
| — |</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">wc</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>
        <span class="nc">String</span> <span class="n">line</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">lineCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">charCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">wordCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">lineCount</span><span class="o">++;</span>
                <span class="n">charCount</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
                <span class="nc">String</span> <span class="n">words</span><span class="o">[]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"\\W"</span><span class="o">);</span>
                <span class="n">wordCount</span> <span class="o">+=</span> <span class="n">words</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
            <span class="o">}</span> <span class="c1">//while</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"wordCount = "</span> <span class="o">+</span> <span class="n">wordCount</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"lineCount = "</span> <span class="o">+</span> <span class="n">lineCount</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"charCount = "</span> <span class="o">+</span> <span class="n">charCount</span><span class="o">);</span>
        <span class="o">}</span> <span class="c1">// try</span>
        <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Error:"</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span> <span class="c1">//catch</span>
    <span class="o">}</span> <span class="c1">//main</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="thuộc-tính-và-dòng-tác-giả">Thuộc tính và dòng tác giả</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Added by Rick */</span>
</code></pre></div></div>

<p>Hệ thống quản lý mã nguồn ghi nhớ rất tốt việc ai đã thêm gì, thêm khi nào,.. Không cần phải làm ô nhiễm code bằng những dòng tác giả. Bạn có thể nghĩ rằng những comment như vậy sẽ hữu ích, người khác sẽ biết ai đã làm việc với phần code đó. Nhưng thực tế là chúng có xu hướng ở lại đó trong nhiều năm, và ngày càng ít chính xác, và ít liên quan.</p>

<p>Nhắc lại lần nữa, hệ thống quản lý mã nguồn là nơi tốt hơn để lưu những thông tin này.</p>

<h3 id="comment-hóa-code">Comment-hóa code</h3>

<p>Comment-hóa code (chuyển code thành comment) là một trong những thói quen khiến lập trình viên dễ bị ghét nhất. Đừng làm việc đó!</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">InputStreamResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">InputStreamResponse</span><span class="o">();</span>
<span class="n">response</span><span class="o">.</span><span class="na">setBody</span><span class="o">(</span><span class="n">formatter</span><span class="o">.</span><span class="na">getResultStream</span><span class="o">(),</span> <span class="n">formatter</span><span class="o">.</span><span class="na">getByteCount</span><span class="o">());</span>
<span class="c1">// InputStream resultsStream = formatter.getResultStream();</span>
<span class="c1">// StreamReader reader = new StreamReader(resultsStream);</span>
<span class="c1">// response.setContent(reader.read(formatter.getByteCount()));</span>
</code></pre></div></div>

<p>Những người khác khi thấy comment dạng này sẽ không đủ dũng cảm để xóa nó. Họ nghĩ rằng nó nằm đó vì một lý do nào đó, và chắc hẳn là nó quan trọng.</p>

<p>Hãy xem xét đoạn code dưới đây:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="o">.</span><span class="na">bytePos</span> <span class="o">=</span> <span class="n">writeBytes</span><span class="o">(</span><span class="n">pngIdBytes</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="c1">//hdrPos = bytePos;</span>
<span class="n">writeHeader</span><span class="o">();</span>
<span class="n">writeResolution</span><span class="o">();</span>
<span class="c1">//dataPos = bytePos;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">writeImageData</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">writeEnd</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">pngBytes</span> <span class="o">=</span> <span class="n">resizeByteArray</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">pngBytes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">maxPos</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">else</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">pngBytes</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">pngBytes</span><span class="o">;</span>
</code></pre></div></div>

<p>Tại sao lại có hai dòng code bị chuyển thành comment? Chúng có quan trọng không? Có phải chúng để lại một lời nhắc cho một số thay đổi sắp xảy ra? Hay chúng chỉ là một dòng comment đã tồn tại từ nhiều năm trước và đơn giản là không ai thèm dọn dẹp?</p>

<p>Đã từng có một thời gian, vào những năm 60, khi những comment dạng này có ích. Nhưng hiện tại hệ thống quản lý mã nguồn đang và sẽ tiếp tục hoạt động tốt. Hệ thống quản lý mã nguồn sẽ nhớ code cho tôi và bạn, và chắc chắn không có lý do gì để comment-hóa một dòng code. Hãy xóa dòng code đó, chúng ta sẽ không bị mất nó. Tôi thề đấy.</p>

<h3 id="html-comment">HTML comment</h3>

<p>Đưa HTML vào comment là một hành động xúc phạm lập trình viên. Như cách mà bạn thấy bên dưới. Nó làm comment khó đọc trực tiếp nhưng lại dễ đọc hơn trên trình soạn thảo hoặc IDE khác. Nếu các comment được trích xuất bởi công cụ và hiển thị như một trang web, việc tô vẽ cho comment bằng HTML là trách nhiệm của công cụ đó, chứ không phải của lập trình viên.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Task to run fit tests.
 * This task runs fitnesse tests and publishes the results.
 * &lt;p/&gt;
 * &lt;pre&gt;
 * Usage:
 * &amp;lt;taskdef name=&amp;quot;execute-fitnesse-tests&amp;quot;
 * classname=&amp;quot;fitnesse.ant.ExecuteFitnesseTestsTask&amp;quot;
 * classpathref=&amp;quot;classpath&amp;quot; /&amp;gt;
 * OR
 * &amp;lt;taskdef classpathref=&amp;quot;classpath&amp;quot;
 * resource=&amp;quot;tasks.properties&amp;quot; /&amp;gt;
 * &lt;p/&gt;
 * &amp;lt;execute-fitnesse-tests
 * suitepage=&amp;quot;FitNesse.SuiteAcceptanceTests&amp;quot;
 * fitnesseport=&amp;quot;8082&amp;quot;
 * resultsdir=&amp;quot;${results.dir}&amp;quot;
 * resultshtmlpage=&amp;quot;fit-results.html&amp;quot;
 * classpathref=&amp;quot;classpath&amp;quot; /&amp;gt;
 * &lt;/pre&gt;
 */</span>
</code></pre></div></div>

<h3 id="thông-tin-phi-tập-trung">Thông tin phi tập trung</h3>

<p>Nếu bắt buộc phải viết một comment, hãy đảm bảo rằng nó giải thích cho phần code gần nó nhất. Đừng cung cấp thông tin của toàn bộ hệ thống trong một comment cục bộ. Xem xét ví dụ dưới đây: Dù thừa thải nhưng nó cung cấp thông tin về cổng mặc định. Tuy nhiên hàm này lại hoàn toàn không có quyền kiểm soát cổng mặc định. Comment không mô tả cho hàm, mà mô tả một phần nào đó trong hệ thống. Tất nhiên, không có gì đảm bảo comment này sẽ được thay đổi khi code mà nó mô tả thay đổi.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Port on which fitnesse would run. Defaults to &lt;b&gt;8082&lt;/b&gt;.
 *
 * @param fitnessePort
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFitnessePort</span><span class="o">(</span><span class="kt">int</span> <span class="n">fitnessePort</span><span class="o">)</span>
<span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">fitnessePort</span> <span class="o">=</span> <span class="n">fitnessePort</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="quá-nhiều-thông-tin">Quá nhiều thông tin</h3>

<p>Đừng đưa các cuộc thảo luận hoặc mô tả không liên quan vào comment của bạn. Comment dưới đây được lấy ra từ một module có chức năng mã hóa và giải mã base64. Một người nào đó có thể đọc code này mà không cần những thông tin phức tạp từ comment.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 RFC 2045 - Multipurpose Internet Mail Extensions (MIME)
 Part One: Format of Internet Message Bodies
 section 6.8. Base64 Content-Transfer-Encoding
 The encoding process represents 24-bit groups of input bits as output
 strings of 4 encoded characters. Proceeding from left to right, a
 24-bit input group is formed by concatenating 3 8-bit input groups.
 These 24 bits are then treated as 4 concatenated 6-bit groups, each
 of which is translated into a single digit in the base64 alphabet.
 When encoding a bit stream via the base64 encoding, the bit stream
 must be presumed to be ordered with the most-significant-bit first.
 That is, the first bit in the stream will be the high-order bit in
 the first 8-bit byte, and the eighth bit will be the low-order bit in
 the first 8-bit byte, and so on.
 */</span>
</code></pre></div></div>

<h3 id="mối-quan-hệ-khó-hiểu">Mối quan hệ khó hiểu</h3>

<p>Sự kết nối giữa comment và code mà nó mô tả nên rõ ràng. Nếu bạn gặp khổ sở khi phải viết comment, ít nhất bạn cũng muốn người khác nhìn vào comment và hiểu những gì nó đang nói về code.</p>

<p>Xem xét ví dụ sau:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 * start with an array that is big enough to hold all the pixels
 * (plus filter bytes), and an extra 200 bytes for header info
 * bắt đầu với một mảng đủ lớn để chứa tất cả các pixel
 * (cộng với một số byte của bộ lọc), và thêm 200 byte cho tiêu đề
 */</span>
 <span class="k">this</span><span class="o">.</span><span class="na">pngBytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[((</span><span class="k">this</span><span class="o">.</span><span class="na">width</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="k">this</span><span class="o">.</span><span class="na">height</span> <span class="o">*</span> <span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="mi">200</span><span class="o">];</span>
</code></pre></div></div>

<p>Một byte của bộ lọc nghĩa là gì? Nó có liên quan gì đến +1 không? Hay *3? Hay cả hai? Tại sao lại là giá trị 200 mà không phải giá trị khác? Mục đích của comment là để giải thích code, không phải giải thích chính nó. Thật đáng tiếc khi comment lại cần một lời giải thích cho riêng mình.</p>

<h3 id="comment-làm-tiêu-đề-cho-hàm">Comment làm tiêu đề cho hàm</h3>

<p>Các hàm ngắn không cần nhiều mô tả. Đặt một cái tên đủ tốt cho hàm thường tốt hơn việc đặt một comment ở trước hàm đó.</p>

<h3 id="javadocs-trong-code-không-công-khai">Javadocs trong code không công khai</h3>

<p>[…] Việc tạo các trang javadoc cho các lớp và các hàm trong hệ thống thường không hữu ích, và thủ tục bổ sung các comment không khác gì sự lộn xộn và làm mất thời gian.</p>

<h3 id="ví-dụ">Ví dụ</h3>

<p>Tôi đã viết module trong Listing 4-7 cho <em>XP Immersion</em> đầu tiên. Nó được dự định là một ví dụ về phong cách viết code xấu và comment xấu. Kent Back sau đó đã tái cấu trúc code này lại dưới hình thức dễ chịu hơn trước mặt hàng tá sinh viên. Sau đó tôi đã điều chỉnh chúng để phù hợp với quyển sách <em>Agile Software Development, Principles, Patterns, and Practices</em> và bài viết <em>Craftsman</em> đầu tiên đã được xuất bản trên tạp chí <em>Software Development</em>.</p>

<p>Điều tôi cảm thấy thú vị trong module này là, đã có lúc nhiều người trong chúng tôi xem nó là một <em>tài liệu tham khảo hay</em>. Còn bây giờ chúng ta xem nó là một mớ lộn xộn. Hãy xem có bao nhiêu vấn đề về comment mà bạn có thể tìm thấy.</p>

<p>| Listing 4-7 <strong>GeneratePrimes.java</strong> |
| — |</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * This class Generates prime numbers up to a user specified
 * maximum. The algorithm used is the Sieve of Eratosthenes.
 * &lt;p&gt;
 * Eratosthenes of Cyrene, b. c. 276 BC, Cyrene, Libya --
 * d. c. 194, Alexandria. The first man to calculate the
 * circumference of the Earth. Also known for working on
 * calendars with leap years and ran the library at Alexandria.
 * &lt;p&gt;
 * The algorithm is quite simple. Given an array of integers
 * starting at 2. Cross out all multiples of 2. Find the next
 * uncrossed integer, and cross out all of its multiples.
 * Repeat untilyou have passed the square root of the maximum
 * value.
 *
 * @author Alphonse
 * @version 13 Feb 2002 atp
 */</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GeneratePrimes</span>
<span class="o">{</span>
    <span class="cm">/**
    * @param maxValue is the generation limit.
    */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">generatePrimes</span><span class="o">(</span><span class="kt">int</span> <span class="n">maxValue</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">maxValue</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">)</span> <span class="c1">// the only valid case</span>
        <span class="o">{</span>
            <span class="c1">// declarations</span>
            <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">maxValue</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="c1">// size of array</span>
            <span class="kt">boolean</span><span class="o">[]</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">boolean</span><span class="o">[</span><span class="n">s</span><span class="o">];</span>
            <span class="kt">int</span> <span class="n">i</span><span class="o">;</span>
            <span class="c1">// initialize array to true.</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">f</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="c1">// get rid of known non-primes</span>
            <span class="n">f</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="c1">// sieve</span>
            <span class="kt">int</span> <span class="n">j</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nc">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="c1">// if i is uncrossed, cross its multiples.</span>
                <span class="o">{</span>
                    <span class="k">for</span> <span class="o">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="n">i</span><span class="o">)</span>
                    <span class="n">f</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// multiple is not prime</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="c1">// how many primes are there?</span>
            <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">[</span><span class="n">i</span><span class="o">])</span>
                <span class="n">count</span><span class="o">++;</span> <span class="c1">// bump count.</span>
            <span class="o">}</span>
            <span class="kt">int</span><span class="o">[]</span> <span class="n">primes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">count</span><span class="o">];</span>
            <span class="c1">// move the primes into the result</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="c1">// if prime</span>
                <span class="n">primes</span><span class="o">[</span><span class="n">j</span><span class="o">++]</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">primes</span><span class="o">;</span> <span class="c1">// return the primes</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="c1">// maxValue &lt; 2</span>
        <span class="k">return</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span> <span class="c1">// return null array if bad input.</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Trong Listing 4-8, bạn có thể thấy một phiên bản được tái cấu trúc của module trên. Chú ý rằng việc sử dụng comment được hạn chế tối đa. Chỉ có hai comment trong toàn bộ module và chúng đều hợp lý.</p>

<p>| Listing 4-8 <strong>GeneratePrimes.java</strong> |
| — |</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * This class Generates prime numbers up to a user specified
 * maximum. The algorithm used is the Sieve of Eratosthenes.
 * Given an array of integers starting at 2:
 * Find the first uncrossed integer, and cross out all its
 * multiples. Repeat until there are no more multiples
 * in the array.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrimeGenerator</span>
<span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="n">crossedOut</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">result</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">generatePrimes</span><span class="o">(</span><span class="kt">int</span> <span class="n">maxValue</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">maxValue</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">)</span>
            <span class="k">return</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="k">else</span>
        <span class="o">{</span>
            <span class="n">uncrossIntegersUpTo</span><span class="o">(</span><span class="n">maxValue</span><span class="o">);</span>
            <span class="n">crossOutMultiples</span><span class="o">();</span>
            <span class="n">putUncrossedIntegersIntoResult</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">uncrossIntegersUpTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">maxValue</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">crossedOut</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">boolean</span><span class="o">[</span><span class="n">maxValue</span> <span class="o">+</span> <span class="mi">1</span><span class="o">];</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">crossedOut</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">crossedOut</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">crossOutMultiples</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="kt">int</span> <span class="n">limit</span> <span class="o">=</span> <span class="n">determineIterationLimit</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">notCrossed</span><span class="o">(</span><span class="n">i</span><span class="o">))</span>
                <span class="n">crossOutMultiplesOf</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">determineIterationLimit</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="c1">// Every multiple in the array has a prime factor that</span>
        <span class="c1">// is less than or equal to the root of the array size,</span>
        <span class="c1">// so we don't have to cross out multiples of numbers</span>
        <span class="c1">// larger than that root.</span>
        <span class="kt">double</span> <span class="n">iterationLimit</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">(</span><span class="n">crossedOut</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">iterationLimit</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">crossOutMultiplesOf</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">multiple</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">;</span>
                <span class="n">multiple</span> <span class="o">&lt;</span> <span class="n">crossedOut</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
                <span class="n">multiple</span> <span class="o">+=</span> <span class="n">i</span><span class="o">)</span>
            <span class="n">crossedOut</span><span class="o">[</span><span class="n">multiple</span><span class="o">]</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">notCrossed</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="n">crossedOut</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">putUncrossedIntegersIntoResult</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">numberOfUncrossedIntegers</span><span class="o">()];</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">crossedOut</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">notCrossed</span><span class="o">(</span><span class="n">i</span><span class="o">))</span>
                <span class="n">result</span><span class="o">[</span><span class="n">j</span><span class="o">++]</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">numberOfUncrossedIntegers</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">crossedOut</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">notCrossed</span><span class="o">(</span><span class="n">i</span><span class="o">))</span>
                <span class="n">count</span><span class="o">++;</span>
        <span class="k">return</span> <span class="n">count</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Thật dễ để chỉ ra comment đầu tiên là dư thừa vì nó đọc rất giống hàm generatePrimes. Tuy nhiên, tôi nghĩ rằng comment giúp người đọc dễ tiếp cận thuật toán, vì vậy tôi có xu hướng để lại nó.</p>

<p>Comment thứ hai chắc chắn là cần thiết. Nó giải thích lý do đằng sau việc sử dụng giá trị căn bậc hai làm giới hạn vòng lặp. Tôi không thể tìm thấy tên biến đơn giản hay cách thức khác để làm rõ điểm này. Mặt khác, việc sử dụng căn bậc hai có thể để lại vài vấn đề. Tôi có tiết kiệm được nhiều thời gian khi dùng giá trị căn bậc hai làm giới hạn cho vòng lặp hay không? Thời gian tiết kiệm được có nhiều hơn thời gian tính căn bậc hai hay không?</p>

<p>Hmm, thật đáng để suy nghĩ. Sử dụng căn bậc hai làm giới hạn vòng lặp đem lại thỏa mãn cho máu hacker trong tôi, nhưng tôi không nghĩ người khác cũng có máu đó. Một comment ở vị trí đó sẽ giúp người đọc dễ dàng hiểu nó hơn.</p>

<h3 id="tham-khảo">Tham khảo</h3>

<p><strong>[KP78]:</strong> Kernighan and Plaugher, <em>The Elements of Programming Style</em>, 2d. ed., McGrawHill, 1978.</p>

  </div><a class="u-url" href="/clean-code/chaper-04" hidden></a>

  <footer class="post-footer">
    <nav class="post-navigation">
      
        <a href="/clean-code/chaper-03" class="prev-post">← Chương 3 - Hàm</a>
      
      
        <a href="/clean-code/chaper-05" class="next-post">Chương 5 - Định dạng code →</a>
      
    </nav>
  </footer>
  
</article>

      </div>
    </main>

    <!--<footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/hondanho" title="hondanho"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>
    </div>

  </div>

</footer>
-->

    <a href="#" id="back-to-top">
      Back To Top &uarr;
    </a>
  </body>

</html>
